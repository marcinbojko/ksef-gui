# Ofelia job scheduler configuration for KSeFCli
# Docs: https://github.com/mcuadros/ofelia

# ── Log rotation ─────────────────────────────────────────────────────────────
# Delete Serilog rolling log files older than 7 days
[job-exec "log-rotate"]
schedule  = @daily
container = ksefcli
command   = find /root/.cache/ksefcli -name "ksefcli-*.log" -mtime +7 -delete

# ── Health probe ──────────────────────────────────────────────────────────────
# Restart ksefcli if it stops responding (Ofelia restarts the container)
[job-run "health-check"]
schedule  = @every 5m
image     = docker:cli
command   = sh -c 'docker inspect --format="{{.State.Health.Status}}" ksefcli | grep -q healthy || docker restart ksefcli'
volume    = /var/run/docker.sock:/var/run/docker.sock

# ── Output directory cleanup ──────────────────────────────────────────────────
# Remove downloaded invoice files older than 365 days (adjust to your retention policy)
# Disabled by default — uncomment and adjust to enable.
#[job-exec "cleanup-old-invoices"]
#schedule  = @weekly
#container = ksefcli
#command   = find /data -name "*.xml" -o -name "*.pdf" -o -name "*.json" -mtime +365 -delete
